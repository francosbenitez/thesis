---
title: "Exploratory analysis of Perceptions about Science and Open Science"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = "png",
                      fig.path = "../images/",
                      dpi = 300)
```

This analysis revolves around the undergraduate thesis carried out by Franco Sebastián Benítez, tutored by Débora Burin and Lucas Cuenya, from the Psychology Department of the University of Buenos Aires.

As set in our preregistration, we are checking the following aspects:

1) Check for exclusion criteria in the demographic data, and in the completion rate.

2) Describe the sample’s demographic characteristics.

3) Analyse the total percentage of “yes” responses to belief in crisis. Analyse as a function of career stage and methodological approach.

4) Qualitative analysis of open field response to belief in crisis.

5) Percentage of agreement with each, and combined, statements about replication crisis, p-value, publication bias. Analyse as a function of career stage and methodological approach.

6) Percentage of agreement with each, and combined, statements about perceived barriers. Analyse as a function of career stage and methodological approach.

7) Percentage of agreement with each, and combined, statements about attitudes against adopting open science practices. Analyse as a function of career stage and methodological approach.

8) Qualitative analysis of open field response to attitudes about barriers against adopting open science practices.

## Loading the neccesary libraries
```{r, message=FALSE}
library(dplyr)        # data wrangling
library(ggplot2)      # plotting
library(readr)        # csv
library(rmarkdown)    # table
library(HH)           # likert
```

## Loading the dataset
```{r, message=FALSE, warning=FALSE}
df <- read_csv("../data/Percepciones sobre ciencia y ciencia abierta_cleaning.csv")
paged_table(df)
```
```{r science, out.width="100%", fig.height=15, fig.width=25}
origNames = colnames(df)
myPanelFunc <- function(...){
  panel.likert(...)
  vals <- list(...)
  DF <- data.frame(x=vals$x, y=vals$y, groups=vals$groups)
  grps <- as.character(DF$groups)
  for(i in 1:length(origNames)){
    grps <- sub(paste0('^',origNames[i]),i,grps)
  }
  DF <- DF[order(DF$y,grps),]
  DF$correctX <- ave(DF$x,DF$y,FUN=function(x){
    x[x < 0] <- rev(cumsum(rev(x[x < 0]))) - x[x < 0]/2
    x[x > 0] <- cumsum(x[x > 0]) - x[x > 0]/2
    return(x)
  })
  subs <- sub(' Positive$','',DF$groups)
  collapse <- subs[-1] == subs[-length(subs)] & DF$y[-1] == DF$y[-length(DF$y)]
  DF$abs <- abs(DF$x)
  DF$abs[c(collapse,FALSE)] <- DF$abs[c(collapse,FALSE)] + DF$abs[c(FALSE,collapse)]
  DF$correctX[c(collapse,FALSE)] <- 0
  DF <- DF[c(TRUE,!collapse),]
  DF$perc <- round(ave(DF$abs,DF$y,FUN=function(x){x/sum(x) * 100}), 0)
  DF$perc <- paste0(DF$perc,'%')
  DF$perc[DF$perc == "0%"] <- ""
  panel.text(x=DF$correctX, y=DF$y, label=DF$perc, cex=1)
}


likert(Measures ~ .,
       data=df,
       ReferenceZero=3,
       as.percent=TRUE,
       positive.order=TRUE,
       main=list("Valore cada una de las siguientes cuestiones relacionadas con su opinión sobre la ciencia",
                 x=unit(.50, "npc")),
       rightAxis=F,
       key.border.white=F,
       panel=myPanelFunc,
       auto.key=list(cex=1.2),
       scales = list(y = list(cex = 1.2)))

```







